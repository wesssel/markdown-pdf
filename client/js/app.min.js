;(function() {
angular.module('app', [
    'ui.router',
    'ngSanitize',
    'wiz.markdown'
]);
}());

;(function() {
routes.$inject = ["$stateProvider", "$urlRouterProvider", "$locationProvider"];
angular.module('app')
.config(routes)

function routes($stateProvider, $urlRouterProvider, $locationProvider) {	
	$stateProvider
	.state('posts', {
		url: '/posts',
		templateUrl: '/app/modules/posts/posts.html',
		controller: 'postsController as vm',
		resolve: {
			posts: ["Posts", function(Posts) {
				return Posts.getAll();
			}]
		}
	})
	.state('create', {
		url: '/create',
		templateUrl: '/app/modules/posts/post.editor.html',
		controller: 'createPostController as vm'
	})
	.state('edit', {
		url: '/post/{id}',
		templateUrl: '/app/modules/posts/post.editor.html',
		controller: 'editPostController as vm',
		resolve: {
			post: ["Posts", "$stateParams", function(Posts, $stateParams) {
				return Posts.get($stateParams.id);
			}]
		}
	})
    
	$urlRouterProvider.otherwise('/create');
};
}());

;(function() {
createPostController.$inject = ["Posts", "$location"];
angular.module('app')
.controller('createPostController', createPostController)

function createPostController(Posts, $location) {
    var vm = this;
    
    vm.submitPost = submitPost;
    
    function submitPost() {
        Posts.create(vm.post)
        .success(function(post) {
            $location.path('/posts');
        })
    }
}
}());

;(function() {
editPostController.$inject = ["post", "Posts", "$location"];
angular.module('app')
.controller('editPostController', editPostController)

function editPostController(post, Posts, $location) {
    var vm = this;
    
    vm.post = post;
    vm.submitPost = submitPost;
    
    function submitPost() {
        Posts.update(vm.post)
        .success(function() {
            $location.path('/posts');
        })
    }
}
}());

;(function() {
postsController.$inject = ["posts", "Posts"];
angular.module('app')
.controller('postsController', postsController)

function postsController(posts, Posts) {
    var vm = this;
    
    vm.removePost = removePost;
    vm.posts = posts.data;
    vm.createPost = createPost;
    
    function removePost(post, index) {
        Posts.remove(post._id)
        .success(function() {
            vm.posts.splice(index, 1);
        })
    }
    
    function createPost() {
        Posts.create(vm.newPost)
        .success(function(post) {
            vm.posts.push(post);
            vm.newPost = {};
        })
    }
}
}());

;(function() {
postsService.$inject = ["$http"];
angular.module('app')
.factory('Posts', postsService)

function postsService($http) {
    var o = {
        create: create,
        get: get,
        getAll: getAll,
        remove: remove,
        update: update
    };
    
    return o;
      
    function create(post) {
        return $http.post('/api/posts/', post);
    };

	function get(post) {
		return $http.get('/api/posts/' + post)
        .then(function(res){
			return res.data;
		});
	};
    
	function getAll() {
		return $http.get('/api/posts')
	};

	function remove(post) {
	  	return $http.delete('/api/posts/' + post);
	};
    
    function update(post) {
	  	return $http.put('/api/posts/' + post._id, post);
    }
}
}());

;(function() {
printPost.$inject = ["Print"];
angular.module('app')
.directive('printPost', printPost)

function printPost(Print) {
    return {
        scope: {
            content: '=content'
        },
        template: '<button ng-click="print()">Print</button>',
        controller: ["$scope", "$element", function($scope, $element){
            $scope.print = print;
            
            function print(){
                Print.print($scope.content)
            }
        }]
    };
};
}());

;(function() {
printService.$inject = ["$http"];
angular.module('app')
.factory('Print', printService)

function printService($http) {
    var o = {
        print: print
    };
    
    return o;
    
    function print(content) {
        return $http.post('/api/print', content);
    };
}
}());
